WindowManager:

<WindowManager>:
    HomeScreen:
        id: homescreen
    PayScreen:
        id: payscreen
    PotScreen:
        id: potscreen
    PotPayScreen:
        id: potpayscreen
    LoyaltyScreen:
        id: loyaltyscreen
    LoyaltyPreScreen:
        id:loyaltyprescreen
    LoyaltyPostScreen:
        id:loyaltypostscreen
    ShowScreen:
        id:showscreen
    ShowNewScreen:
        id:shownewscreen
    SortScreen:
        id:sortscreen
    NewPotScreen:
        id:newpotscreen
    NewLoyaltyScreen:
        id:newloyaltyscreen
<HomeScreen>:
    name: 'home'
    BoxLayout:
        orientation:'vertical'
        ScrollView:
            StackLayout:
                id: potlayout
                MDRaisedButton:
                    id: load
                    text: 'Load Pots'
                    size_hint: 0.25, 0.05
                    pos_hint: {'center_x': 0.5, 'center_y':0.95}
                    on_press:
                        root.load_pots()
                        self.opacity = 0
        BoxLayout:
            orientation: 'vertical'
            MDLabel:
                id:value
                text: root.pay_amount
                opacity: 0
            MDLabel:
                id: amount
                text : "Amount: " + root.pay_amount + " GBP"
                pos_hint: {'center_x': 0.5, 'center_y': 0.5}
                halign: 'center'
                size_hint: 0.8, 0.1
                font_size: 20
                font_name: "Lcd.ttf"
            BoxLayout:
                orientation: 'horizontal'
                MDRaisedButton:
                    id: justpay
                    text: 'Just Pay'
                    pos_hint: {'center_x': 0.5, 'center_y':0.3}
                    size_hint: 0.5, 0.3
                    halign: 'left'
                    on_press:
                        root.manager.ids.payscreen.ids.amount.text = "Amount: " + root.pay_amount+ " GBP"
                        root.manager.ids.payscreen.ids.value.text = root.pay_amount
                        root.manager.current = 'pay'
                MDRaisedButton:
                    text: 'Get'
                    pos_hint: {'center_x': 0.8, 'center_y':0.3}
                    size_hint: 0.15, 0.3
                    halign: 'right'
                    on_press: root.get_amount()
        BoxLayout:
            orientation:'horizontal'
            MDRaisedButton:
                id: loyalty
                text: 'Loyalty'
                pos_hint: {'center_x': 0.2, 'center_y':0.2}
                size_hint: 0.1, 0.2
                on_press: root.manager.current = 'loyalty'
            MDRaisedButton:
                id: sort
                text: 'Sort'
                pos_hint: {'center_x': 0.5, 'center_y':0.2}
                size_hint: 0.1, 0.2
                on_press: root.manager.current = 'sort'
            MDRaisedButton:
                id: addpot
                text: 'New'
                pos_hint: {'center_x': 0.8, 'center_y':0.2}
                size_hint: 0.1, 0.2
                on_press:
                    root.manager.current = "newpot"
<PayScreen>:
    name: 'pay'
    MDLabel:
        id: value
        opacity: 0
    MDLabel:
        id: amount
        pos_hint: {'center_x': 0.5, 'center_y': 0.95}
        size_hint: 0.8, 0.15
        font_size: 20
        font_name: "Lcd.ttf"
    MDLabel:
        id:potname
        pos_hint: {'center_x': 0.5, 'center_y':0.9}
        size_hint: 0.2, 0.15
        opacity: 0
    MDRaisedButton:
        id: paynow
        text: 'Pay Now'
        pos_hint: {'center_x': 0.5, 'center_y':0.5}
        size_hint: 0.5, 0.2
        on_press:root.just_pay(self, root.ids.value.text, root.manager.ids.loyaltypostscreen.ids.loyaltycode.text)

    BoxLayout:
        orientation: 'horizontal'
        MDRaisedButton:
            text:"Show"
            pos_hint: {'center_x': 0.8, 'center_y':0.2}
            size_hint: 0.1, 0.1
            on_release:
                root.show_table()
        MDRaisedButton:
            text: 'Home'
            on_press: root.manager.current = 'home'
            pos_hint: {'center_x': 0.2, 'center_y':0.2}
            size_hint: 0.1, 0.1

<PotScreen>:
    name: 'pot'
    BoxLayout:
        orientation: 'vertical'
        MDLabel:
            id:value
            opacity: 0
        MDLabel:
            id: amount
            pos_hint: {'center_x': 0.5, 'center_y': 0.8}
            size_hint: 0.8, 0.2
            font_name: "Lcd.ttf"
            valign: 'bottom'
            halign: 'center'
            bold: True
        BoxLayout:
            orientation:'horizontal'
            MDLabel:
                id:potname
                pos_hint: {'center_x': 0.2, 'center_y':0.6}
                size_hint: 0.3, 0.2
                color: (1,0,0,0.5)
                bold: True
                outline_color: (0,1,0,0.5)
                outline_width: 5
                background_color: (0,0,1,0.5)
                canvas.before:
                    Color:
                        rgba: self.background_color
                    Rectangle:
                        size: self.size
                        pos: self.pos
            MDLabel:
                id:potlimit
                pos_hint: {'center_x': 0.5, 'center_y':0.6}
                size_hint: 0.3, 0.1
            MDLabel:
                id:potrem
                pos_hint: {'center_x': 0.8, 'center_y':0.6}
                size_hint: 0.3, 0.1

        MDRaisedButton:
            id: confirm
            text: 'Confirm'
            pos_hint: {'center_x': 0.5, 'center_y':0.4}
            size_hint: 0.5, 0.1
            halign: 'center'
            on_press:root.confirm_pay(self,root.ids.potname.text, root.ids.value.text, root.manager.ids.loyaltypostscreen.ids.loyaltycode.text)
        MDRaisedButton:
            text: 'Cancel'
            pos_hint: {'center_x': 0.2, 'center_y':0.3}
            size_hint: 0.2, 0.1
            halign: 'center'
            on_press:
                root.manager.current = 'home'
                root.manager.ids.homescreen.clear_pots()
                root.manager.ids.payscreen.ids.potname.text = "None"
        BoxLayout:
            orientation: 'horizontal'
            MDRaisedButton:
                text: 'Sort'
                on_press: root.manager.current = 'sort'
                pos_hint: {'center_x': 0.2, 'center_y':0.2}
                size_hint: 0.1, 0.1
            MDRaisedButton:
                text: 'Home'
                on_press: root.manager.current = 'home'
                pos_hint: {'center_x': 0.8, 'center_y':0.2}
                size_hint: 0.1, 0.1

<PotPayScreen>:
    name: 'potpay'
    MDLabel:
        text: root.pot_selected
        pos_hint: {'center_x': 0.5, 'center_y':0.9}
        size_hint: 0.5, 0.3
    BoxLayout:
        orientation: 'horizontal'
        MDRaisedButton:
            text: 'Sort'
            on_press: root.manager.current = 'sort'
            pos_hint: {'center_x': 0.2, 'center_y':0.2}
            size_hint: 0.1, 0.1
        MDRaisedButton:
            text: 'Home'
            on_press: root.manager.current = 'home'
            pos_hint: {'center_x': 0.8, 'center_y':0.2}
            size_hint: 0.1, 0.1

<LoyaltyScreen>:
    name: 'loyalty'
    BoxLayout:
        orientation: 'vertical'
        MDLabel:
            text: 'Select your loyalty card'
            pos_hint: {'center_x': 0.5, 'center_y':0.8}
            size_hint: 0.8, 0.1
        ScrollView:
            StackLayout:
                MDRaisedButton:
                    text: 'Show Loyalty Cards'
                    pos_hint: {'center_x': 0.5, 'center_y':0.6}
                    size_hint: 0.5, 0.1
                    on_press:
                        root.load_loyalty()
                        self.opacity = 0
        MDRaisedButton:
            text: "Add a new loyalty card"
            pos_hint: {'center_x': 0.5, 'center_y':0.4}
            size_hint: 0.8, 0.1
            on_press:
                root.manager.current = 'newloyalty'
        BoxLayout:
            orientation: 'horizontal'
            MDRaisedButton:
                text: 'Sort'
                on_press: root.manager.current = 'sort'
                pos_hint: {'center_x': 0.2, 'center_y':0.2}
                size_hint: 0.1, 0.1
            MDRaisedButton:
                text: 'Home'
                on_press: root.manager.current = 'home'
                pos_hint: {'center_x': 0.8, 'center_y':0.2}
                size_hint: 0.1, 0.1

<LoyaltyPreScreen>:
    name: 'preloyalty'
    BoxLayout:
        orientation: 'vertical'
        MDLabel:
            id:loyalty
            text: ''
            opacity: 0
        MDLabel:
            id: loyaltyname
            text: ''
            pos_hint: {'center_x': 0.5, 'center_y':0.8}
            size_hint: 0.5, 0.1
        MDLabel:
            id: loyaltycode
            text: ''
            opacity: 0
        Image:
            id: loyaltybarcode
            text: ''
            pos_hint: {'center_x': 0.5, 'center_y':0.5}
            size_hint: 0.9, 0.3
            halign: 'center'
        MDRaisedButton:
            text: 'Scan'
            pos_hint: {'center_x': 0.5, 'center_y':0.4}
            size_hint: 0.5, 0.1
            halign: 'center'
            on_press:
                root.scan_loyalty(root.ids.loyaltyname.text)
                root.manager.current = 'postloyalty'
                root.manager.ids.homescreen.ids.loyalty.disabled = True

        MDRaisedButton:
            text: 'Back'
            on_press: root.manager.current = 'loyalty'
            pos_hint: {'center_x': 0.5, 'center_y':0.2}
            size_hint: 0.5, 0.1
            halign: 'center'

<LoyaltyPostScreen@MDScreen>:
    name: 'postloyalty'
    BoxLayout:
        orientation: 'vertical'
        MDLabel:
            id: loyaltycode
            text: ''
            opacity: 0
        MDRaisedButton:
            text: 'Proceed'
            on_press: root.manager.current = 'home'
            pos_hint: {'center_x': 0.5, 'center_y':0.5}
            size_hint: 0.5, 0.2
    BoxLayout:
        orientation: 'horizontal'
        name: 'postloyalty'
        MDRaisedButton:
            text: 'Sort'
            on_press: root.manager.current = 'preloyalty'
            pos_hint: {'center_x': 0.2, 'center_y':0.2}
            size_hint: 0.1, 0.1
        MDRaisedButton:
            text: 'Home'
            on_press: root.manager.current = 'home'
            pos_hint: {'center_x': 0.8, 'center_y':0.2}
            size_hint: 0.1, 0.1

<ShowScreen@MDScreen>:
    name: 'show'
    MDRaisedButton:
        text: 'Home'
        on_press: root.manager.current = 'home'
        pos_hint: {'center_x': 0.5, 'center_y':0.5}
        size_hint: 0.1, 0.1

<ShowNewScreen@MDScreen>:
    name: 'shownew'
    MDRaisedButton:
        text: 'Home'
        on_press: root.manager.current = 'home'
        pos_hint: {'center_x': 0.5, 'center_y':0.5}
        size_hint: 0.1, 0.1

<SortScreen>:
    name: 'sort'
    BoxLayout:
        orientation: 'vertical'
        MDTopAppBar:
            title: "Pot"
            pos_hint: {"top":0.9}
            left_action_items: [["menu", lambda x: root.dropdown(x)]]
        MDRaisedButton:
            id: menu
            text: "Press me"
            pos_hint: {'center_x':0.5, 'center_y':0.7}
            on_release: root.dropdown(self)
        MDRaisedButton:
            text: 'Home'
            on_press: root.manager.current = 'home'
            pos_hint: {'center_x': 0.5, 'center_y':0.5}
            size_hint: 0.1, 0.1
        BoxLayout:
            orientation: 'horizontal'
            MDRaisedButton:
                text:"Show"
                pos_hint: {'center_x': 0.8, 'center_y':0.2}
                size_hint: 0.1, 0.1
                on_release:
                    root.show_table()
            MDRaisedButton:
                text: 'Home'
                on_press: root.manager.current = 'home'
                pos_hint: {'center_x': 0.2, 'center_y':0.2}
                size_hint: 0.1, 0.1
<NewPotScreen>:
    name: 'newpot'
    BoxLayout:
        orientation: 'vertical'
        spacing: 10
        BoxLayout:
            orientation: 'horizontal'
            ScrollView:
                StackLayout:
                    id: pottable
                    MDRaisedButton:
                        id: loadnames
                        text: 'Pot'
                        pos_hint: {'center_x': 0.2, 'center_y':0.95}
                        on_press:
                            root.load_names()
                            self.disabled = True
            ScrollView:
                StackLayout:
                    MDRaisedButton:
                        id: loadlimits
                        text: 'Limit'
                        pos_hint: {'center_x': 0.5, 'center_y':0.95}
                        on_press:
                            root.load_limits()
                            self.disabled = True
            ScrollView:
                StackLayout:
                    MDRaisedButton:
                        id: loadrems
                        text: 'Balance'
                        pos_hint: {'center_x': 0.8, 'center_y':0.95}
                        on_press:
                            root.load_rems()
                            self.disabled = True
        MDTextField:
            id: potname
            hint_text: "Enter pot name"
            helper_text: "use a meaningful name"
            helper_text_mode: "on_focus"
            icon_right: "account-card"
            icon_right_color: app.theme_cls.primary_color
            text: "Unknown"
        MDTextField:
            id: potlimit
            hint_text: "Enter pot limit"
            helper_text: "put a number"
            helper_text_mode: "on_focus"
            icon_right: "account-card"
            icon_right_color: app.theme_cls.primary_color
        BoxLayout:
            orientation: 'horizontal'
            MDRaisedButton:
                id:confirm
                text: 'Confirm'
                pos_hint: {'center_x': 0.2, 'center_y':0.3}
                size_hint: 0.1, 0.1
                on_press:
                    root.add_pot(root.ids.potname.text, root.ids.potlimit.text)
                    root.manager.current = 'home'
                    root.manager.ids.homescreen.load_new_pot(root.ids.potname.text)
            MDRaisedButton:
                text: 'Cancel'
                pos_hint: {'center_x': 0.8, 'center_y':0.3}
                size_hint: 0.1, 0.1
                on_press:
                    root.manager.current = 'home'
        MDRaisedButton:
            text: 'Home'
            pos_hint: {'center_x': 0.5, 'center_y':0.2}
            size_hint: 0.1, 0.1
            on_press:
                root.manager.current = 'home'
<NewLoyaltyScreen>:
    name: 'newloyalty'
    BoxLayout:
        orientation: 'vertical'
        MDTextField:
            id: loyaltyname
            hint_text: "Enter loyalty name"
            helper_text: "use a valid name"
            helper_text_mode: "on_focus"
            icon_right: "account-card"
            icon_right_color: app.theme_cls.primary_color
            text: "Unknown"
        MDTextField:
            id: loyaltycode
            hint_text: "Enter the code"
            helper_text: "put a 12 digit number"
            helper_text_mode: "on_focus"
            icon_right: "account-card"
            icon_right_color: app.theme_cls.primary_color
        BoxLayout:
            orientation: 'horizontal'
            MDRaisedButton:
                id:confirm
                text: 'Confirm'
                pos_hint: {'center_x': 0.2, 'center_y':0.3}
                size_hint: 0.1, 0.1
                on_press:
                    root.add_loyalty(root.ids.loyaltyname.text, root.ids.loyaltycode.text)
                    root.manager.current = 'loyalty'
                    root.manager.ids.loyaltyscreen.load_new_loyalty(root.ids.loyaltyname.text)
            MDRaisedButton:
                text: 'Cancel'
                pos_hint: {'center_x': 0.8, 'center_y':0.3}
                size_hint: 0.1, 0.1
                on_press:
                    root.manager.current = 'loyalty'
        MDRaisedButton:
            text: 'Home'
            pos_hint: {'center_x': 0.5, 'center_y':0.2}
            size_hint: 0.1, 0.1
            on_press:
                root.manager.current = 'home'